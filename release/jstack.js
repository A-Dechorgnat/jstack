var JSTACK=JSTACK||{};JSTACK.VERSION="0.1";JSTACK.AUTHORS="GING";JSTACK.Comm=function(d,f){var e;e=function(d,g,b,a,c,h){var i,e;i=new XMLHttpRequest;i.open(d,g,!0);i.setRequestHeader("Content-Type","application/json");i.setRequestHeader("Accept","application/json");i.onreadystatechange=function(){if(4===i.readyState)switch(i.status){case 100:case 200:case 201:case 202:case 203:case 204:case 205:e=f;i.responseText!==f&&""!==i.responseText&&(e=JSON.parse(i.responseText));c(e);break;case 400:h("400 Bad Request");break;case 401:h("401 Unauthorized");break;case 403:h("403 Forbidden");
break;default:h(i.status+" Error")}};a!==f&&i.setRequestHeader("X-Auth-Token",a);b!==f?(d=JSON.stringify(b),i.send(d)):i.send()};return{get:function(d,g,b,a){e("GET",d,f,g,b,a)},post:function(d,g,b,a,c){e("POST",d,g,b,a,c)},put:function(d,g,b,a,c){e("PUT",d,g,b,a,c)},del:function(d,g,b,a){e("DELETE",d,f,g,b,a)}}}(JSTACK);JSTACK.Utils=function(d){var f,e;f=function(d){var g="",b,a,d=d.replace(/\r\n/g,"\n");for(b=0;b<d.length;b+=1)a=d.charCodeAt(b),128>a?g+=String.fromCharCode(a):(127<a&&2048>a?g+=String.fromCharCode(a>>6|192):(g+=String.fromCharCode(a>>12|224),g+=String.fromCharCode(a>>6&63|128)),g+=String.fromCharCode(a&63|128));return g};e=function(d){for(var g="",b=0,a=0,c=0,h=0;b<d.length;)a=d.charCodeAt(b),128>a?(g+=String.fromCharCode(a),b+=1):191<a&&224>a?(c=d.charCodeAt(b+1),g+=String.fromCharCode((a&31)<<
6|c&63),b+=2):(c=d.charCodeAt(b+1),h=d.charCodeAt(b+2),g+=String.fromCharCode((a&15)<<12|(c&63)<<6|h&63),b+=3);return g};return{encode:function(e){for(var g="",b,a,c,h,i,k,l=0,e=f(e);l<e.length;)b=e.charCodeAt(l+=1),a=e.charCodeAt(l+=1),c=e.charCodeAt(l+=1),h=b>>2,b=(b&3)<<4|a>>4,i=(a&15)<<2|c>>6,k=c&63,isNaN(a)?i=k=64:isNaN(c)&&(k=64),g=g+d.Utils.keyStr.charAt(h)+Base64.keyStr.charAt(b)+d.Utils.keyStr.charAt(i)+Base64.keyStr.charAt(k);return g},decode:function(f){for(var g="",b,a,c,h,i,k=0,f=f.replace(/[^A-Za-z0-9\+\/\=]/g,
"");k<f.length;)b=d.Utils.keyStr.indexOf(f.charAt(k+=1)),a=d.Utils.keyStr.indexOf(f.charAt(k+=1)),h=d.Utils.keyStr.indexOf(f.charAt(k+=1)),i=d.Utils.keyStr.indexOf(f.charAt(k+=1)),b=b<<2|a>>4,a=(a&15)<<4|h>>2,c=(h&3)<<6|i,g+=String.fromCharCode(b),64!==h&&(g+=String.fromCharCode(a)),64!==i&&(g+=String.fromCharCode(c));return g=e(g)}}}(JSTACK);JSTACK.Keystone=function(d,f){var e,j;j={DISCONNECTED:0,AUTHENTICATING:1,AUTHENTICATED:2,AUTHENTICATION_ERROR:3};e={url:f,currentstate:f,access:f,token:f};createuser=function(g,b,a,c,h,i,f){e.currentstate===d.Keystone.STATES.AUTHENTICATED&&d.Comm.post(e.adminUrl+"users",{user:{name:name,password:b,tenantId:a,email:c,enabled:h}},e.token,i,f)};getusers=function(g,b,a){if(e.currentstate===d.Keystone.STATES.AUTHENTICATED){var c="",c=g!==f?e.adminUrl+"tenants/"+g+"/users":e.adminUrl+"users";d.Comm.get(c,
e.token,b,a)}};getuser=function(g,b,a){e.currentstate===d.Keystone.STATES.AUTHENTICATED&&d.Comm.get(e.adminUrl+"users"+g,e.token,b,a)};deleteuser=function(g,b,a){e.currentstate===d.Keystone.STATES.AUTHENTICATED&&d.Comm.del(e.adminUrl+"users"+g,e.token,b,a)};getuserroles=function(g,b,a,c){if(e.currentstate===d.Keystone.STATES.AUTHENTICATED){var h="",h=b!==f?e.adminUrl+"tenants/"+b+"/users"+g+"/roles":e.adminUrl+"users"+g+"/roles";d.Comm.get(h,e.token,a,c)}};adduserrole=function(g,b,a,c,h){if(e.currentstate===
d.Keystone.STATES.AUTHENTICATED){var i="",i=a!==f?e.adminUrl+"tenants/"+a+"/users"+g+"/roles/OS-KSADM/"+b:e.adminUrl+"users"+g+"/roles/OS-KSADM/"+b;d.Comm.put(i,e.token,c,h)}};removeuserrole=function(g,b,a,c,h){if(e.currentstate===d.Keystone.STATES.AUTHENTICATED){var i="",i=a!==f?e.adminUrl+"tenants/"+a+"/users"+g+"/roles/OS-KSADM/"+b:e.adminUrl+"users"+g+"/roles/OS-KSADM/"+b;d.Comm.del(i,e.token,c,h)}};createtenant=function(g,b,a,c,h){e.currentstate===d.Keystone.STATES.AUTHENTICATED&&d.Comm.post(e.adminUrl+
"tenants",{tenant:{name:g,description:b,enabled:a}},e.token,c,h)};deletetenant=function(g,b,a){e.currentstate===d.Keystone.STATES.AUTHENTICATED&&d.Comm.del(e.adminUrl+"tenants"+g,data,e.token,b,a)};return{STATES:j,params:e,init:function(d,b){console.log("Admin URL"+b);e.url=d;e.adminUrl=b;e.access=f;e.token=f;e.currentstate=j.DISCONNECTED},authenticate:function(g,b,a,c,h,i){var k={},k=a!==f?{auth:{token:{id:a}}}:{auth:{passwordCredentials:{username:g,password:b}}};c!==f&&(k.auth.tenantId=c);e.currentstate=
j.AUTHENTICATING;d.Comm.post(e.url+"tokens",k,f,function(a){e.currentstate=d.Keystone.STATES.AUTHENTICATED;e.access=a.access;e.token=e.access.token.id;h!==f&&h(a)},function(a){e.currentstate=j.AUTHENTICATION_ERROR;i(a)})},gettenants:function(g){e.currentstate===d.Keystone.STATES.AUTHENTICATED&&d.Comm.get(e.url+"tenants",e.token,function(d){g!==f&&g(d)},function(d){throw Error(d);})},getservice:function(d){var b,a;if(e.currentstate!==j.AUTHENTICATED)return f;for(b in e.access.serviceCatalog)if(e.access.serviceCatalog[b]!==
f&&(a=e.access.serviceCatalog[b],d===a.type))return a;return f},getservicelist:function(){return e.currentstate!==j.AUTHENTICATED?f:e.access.serviceCatalog},createuser:createuser,getusers:getusers,getuser:getuser,deleteuser:deleteuser,getuserroles:getuserroles,adduserrole:adduserrole,removeuserrole:removeuserrole,createtenant:createtenant,deletetenant:deletetenant}}(JSTACK);JSTACK.Nova=function(d,f){var e,j,g,b;e=f;j="publicURL";g=function(){return d.Keystone!==f&&d.Keystone.params.currentstate===d.Keystone.STATES.AUTHENTICATED?(e=d.Keystone.getservice("compute").endpoints[0][j],!0):!1};b=function(a,c,h,b){g()&&(a=e+"/servers/"+a+"/action",d.Comm.post(a,c,d.Keystone.params.token,function(a){b!==f&&b(a)},function(a){throw Error(a);}))};return{configure:function(a){if("adminURL"===a||"internalURL"===a||"publicURL"===a)j=a},getserverlist:function(a,c,h){var b;g()&&(b=e+
"/servers",a!==f&&a&&(b+="/detail"),c&&(b+="?all_tenants="+c),d.Comm.get(b,d.Keystone.params.token,function(a){h!==f&&h(a)},function(a){throw Error(a);}))},getserverdetail:function(a,c){var h;g()&&(h=e+"/servers/"+a,d.Comm.get(h,d.Keystone.params.token,function(a){c!==f&&c(a)},function(a){throw Error(a);}))},getserverips:function(a,c,h){g()&&(a=e+"/servers/"+a+"/ips",c!==f&&(a+="/"+c),d.Comm.get(a,d.Keystone.params.token,function(a){h!==f&&h(a)},function(a){throw Error(a);}))},updateserver:function(a,
c,h){g()&&(a=e+"/servers/"+a,c!==f&&d.Comm.put(a,{server:{name:c}},d.Keystone.params.token,function(a){h!==f&&h(a)},function(a){throw Error(a);}))},createserver:function(a,c,h,b,k,j,m,n,o,p){var r=[],q;if(g()){a={server:{name:a,imageRef:c,flavorRef:h}};b!==f&&(a.server.key_name=b);k!==f&&(a.server.user_data=d.Utils.encode(k));if(j!==f){for(q in j)j[q]!==f&&(b={name:j[q]},r.push(b));a.server.security_groups=r}m===f&&(m=1);a.server.min_count=m;n===f&&(n=1);a.server.max_count=n;o!==f&&(a.server.availability_zone=
d.Utils.encode(o));d.Comm.post(e+"/servers",a,d.Keystone.params.token,function(a){p!==f&&p(a)},function(a){throw Error(a);})}},deleteserver:function(a,c){var b;g()&&(b=e+"/servers/"+a,d.Comm.del(b,d.Keystone.params.token,function(a){c!==f&&c(a)},function(a){throw Error(a);}))},changepasswordserver:function(a,c,d){c!==f&&b(a,{changePassword:{adminPass:c}},d)},rebootserverhard:function(a,c){b(a,{reboot:{type:"HARD"}},c)},rebootserversoft:function(a,c){b(a,{reboot:{type:"SOFT"}},c)},resizeserver:function(a,
c,d){b(a,{resize:{flavorRef:c}},d)},confirmresizedserver:function(a,c){b(a,{confirmResize:null},c)},revertresizedserver:function(a,c){b(a,{revertResize:null},c)},startserver:function(a,c){b(a,{"os-start":null},c)},stopserver:function(a,c){b(a,{"os-stop":null},c)},pauseserver:function(a,c){b(a,{pause:null},c)},unpauseserver:function(a,c){b(a,{unpause:null},c)},suspendserver:function(a,c){b(a,{suspend:null},c)},resumeserver:function(a,c){b(a,{resume:null},c)},createimage:function(a,c,d,e){c={createImage:{name:c}};
c.createImage.metadata={};d!==f&&(c.createImage.metadata=d);b(a,c,e)},getflavorlist:function(a,c){var b;g()&&(b=e+"/flavors",a!==f&&a&&(b+="/detail"),d.Comm.get(b,d.Keystone.params.token,function(a){c!==f&&c(a)},function(a){throw Error(a);}))},getflavordetail:function(a,c){var b;g()&&(b=e+"/flavors/"+a,d.Comm.get(b,d.Keystone.params.token,function(a){c!==f&&c(a)},function(a){throw Error(a);}))},createflavor:function(a,c,b,i,k,j,m,n,o){var p;g()&&(p=e+"/flavors",a={flavor:{name:a,ram:c,vcpus:b,disk:i,
id:k,swap:0,"OS-FLV-EXT-DATA:ephemeral":0,rxtx_factor:0}},j!==f&&(a.flavor["OS-FLV-EXT-DATA:ephemeral"]=j),m!==f&&(a.flavor.swap=m),n!==f&&(a.flavor.rxtx_factor=n),d.Comm.post(p,a,d.Keystone.params.token,function(a){o!==f&&o(a)},function(a){throw Error(a);}))},deleteflavor:function(a,c){var b;g()&&(b=e+"/flavors/"+a,d.Comm.del(b,d.Keystone.params.token,function(a){c!==f&&c(a)},function(a){throw Error(a);}))},getimagelist:function(a,c){var b;g()&&(b=e+"/images",a!==f&&a&&(b+="/detail"),d.Comm.get(b,
d.Keystone.params.token,function(a){c!==f&&c(a)},function(a){throw Error(a);}))},getimagedetail:function(a,c){var b;g()&&(b=e+"/images/"+a,d.Comm.get(b,d.Keystone.params.token,function(a){c!==f&&c(a)},function(a){throw Error(a);}))},deleteimage:function(a,c){var b;g()&&(b=e+"/images/"+a,d.Comm.del(b,d.Keystone.params.token,function(a){c!==f&&c(a)},function(a){throw Error(a);}))},getkeypairlist:function(a){var c;g()&&(c=e+"/os-keypairs",d.Comm.get(c,d.Keystone.params.token,function(c){a!==f&&a(c)},
function(a){throw Error(a);}))},createkeypair:function(a,c,b){var i;g()&&(i=e+"/os-keypairs",a={keypair:{name:a}},c!==f&&(a.keypair.public_key=c),d.Comm.post(i,a,d.Keystone.params.token,function(a){b!==f&&b(a)},function(a){throw Error(a);}))},deletekeypair:function(a,b){var h;g()&&(h=e+"/os-keypairs/"+a,d.Comm.del(h,d.Keystone.params.token,function(a){b!==f&&b(a)},function(a){throw Error(a);}))},getvncconsole:function(a,c,d){if(g()){if(c===f||!c)c="novnc";b(a,{"os-getVNCConsole":{type:c}},null,d)}},
getconsoleoutput:function(a,c,d){if(g()){if(c===f||!c)c=35;b(a,{"os-getConsoleOutput":{length:c}},null,d)}},getattachedvolumes:function(a,b){var h;g()&&(h=e+"/servers/"+a+"/os-volume_attachments",d.Comm.get(h,d.Keystone.params.token,function(a){b!==f&&b(a)},function(a){throw Error(a);}))},attachvolume:function(a,b,h,i){g()&&(a=e+"/servers/"+a+"/os-volume_attachments",b===f||h===f||d.Comm.post(a,{volumeAttachment:{volumeId:b,device:h}},d.Keystone.params.token,function(a){i!==f&&i(a)},function(a){throw Error(a);
}))},detachvolume:function(a,b,h){g()&&(a=e+"/servers/"+a+"/os-volume_attachments/"+b,b!==f&&d.Comm.del(a,d.Keystone.params.token,function(a){h!==f&&h(a)},function(a){throw Error(a);}))},getattachedvolume:function(a,b,h){g()&&(a=e+"/servers/"+a+"/os-volume_attachments/"+b,b!==f&&d.Comm.get(a,d.Keystone.params.token,function(a){h!==f&&h(a)},function(a){throw Error(a);}))}}}(JSTACK);JSTACK.Nova.Volume=function(d,f){var e,j,g;e=f;j="publicURL";g=function(){return d.Keystone!==f&&d.Keystone.params.currentstate===d.Keystone.STATES.AUTHENTICATED?(e=d.Keystone.getservice("volume").endpoints[0][j],!0):!1};return{configure:function(b){if("adminURL"===b||"internalURL"===b||"publicURL"===b)j=b},getvolumelist:function(b,a){var c;g()&&(c=e+"/volumes",b!==f&&b&&(c+="/detail"),d.Comm.get(c,d.Keystone.params.token,function(b){a!==f&&a(b)},function(a){throw Error(a);}))},createvolume:function(b,
a,c,h){g()&&(b={volume:{size:b}},a!==f&&(b.volume.display_name=a),c!==f&&(b.volume.display_description=c),d.Comm.post(e+"/volumes",b,d.Keystone.params.token,function(a){h!==f&&h(a)},function(a){throw Error(a);}))},deletevolume:function(b,a){var c;g()&&(c=e+"/volumes/"+b,d.Comm.del(c,d.Keystone.params.token,function(b){a!==f&&a(b)},function(a){throw Error(a);}))},getvolume:function(b,a){var c;g()&&(c=e+"/volumes/"+b,d.Comm.get(c,d.Keystone.params.token,function(b){a!==f&&a(b)},function(a){throw Error(a);
}))},getsnapshotlist:function(b,a){var c;g()&&(c=e+"/snapshots",b!==f&&b&&(c+="/detail"),d.Comm.get(c,d.Keystone.params.token,function(b){a!==f&&a(b)},function(a){throw Error(a);}))},createsnapshot:function(b,a,c,h){g()&&(b={snapshot:{volume_id:b,force:!0}},a!==f&&(b.snapshot.display_name=a),c!==f&&(b.snapshot.display_description=c),d.Comm.post(e+"/snapshots",b,d.Keystone.params.token,function(a){h!==f&&h(a)},function(a){throw Error(a);}))},deletesnapshot:function(b,a){var c;g()&&(c=e+"/snapshots/"+
b,d.Comm.del(c,d.Keystone.params.token,function(b){a!==f&&a(b)},function(a){throw Error(a);}))},getsnapshot:function(b,a){var c;g()&&(c=e+"/snapshots/"+b,d.Comm.get(c,d.Keystone.params.token,function(b){a!==f&&a(b)},function(a){throw Error(a);}))}}}(JSTACK);JSTACK.Glance=function(d,f){var e,j,g;e=f;j="publicURL";g=function(){return d.Keystone!==f&&d.Keystone.params.currentstate===d.Keystone.STATES.AUTHENTICATED?(e=d.Keystone.getservice("image").endpoints[0][j],!0):!1};return{configure:function(b){if("adminURL"===b||"internalURL"===b||"publicURL"===b)j=b},getimagelist:function(b,a){var c;g()&&(c=e+"/images",b!==f&&b&&(c+="/detail"),d.Comm.get(c,d.Keystone.params.token,function(b){a!==f&&a(b)},function(a){throw Error(a);}))}}}(JSTACK);
