var JSTACK=JSTACK||{};JSTACK.VERSION="0.1";JSTACK.AUTHORS="GING";JSTACK.Comm=function(d,e){var f;f=function(d,g,b,a,c,h){var i,f;i=new XMLHttpRequest;i.open(d,g,!0);i.setRequestHeader("Content-Type","application/json");i.setRequestHeader("Accept","application/json");i.onreadystatechange=function(){if(4===i.readyState)switch(i.status){case 100:case 200:case 201:case 202:case 203:case 204:case 205:f=e;i.responseText!==e&&""!==i.responseText&&(f=JSON.parse(i.responseText));c(f);break;case 400:h("400 Bad Request");break;case 401:h("401 Unauthorized");break;case 403:h("403 Forbidden");
break;default:h(i.status+" Error")}};a!==e&&i.setRequestHeader("X-Auth-Token",a);b!==e?(d=JSON.stringify(b),i.send(d)):i.send()};return{get:function(d,g,b,a){f("GET",d,e,g,b,a)},post:function(d,g,b,a,c){f("POST",d,g,b,a,c)},put:function(d,g,b,a,c){f("PUT",d,g,b,a,c)},del:function(d,g,b,a){f("DELETE",d,e,g,b,a)}}}(JSTACK);JSTACK.Utils=function(d){var e,f;e=function(d){var g="",b,a,d=d.replace(/\r\n/g,"\n");for(b=0;b<d.length;b+=1)a=d.charCodeAt(b),128>a?g+=String.fromCharCode(a):(127<a&&2048>a?g+=String.fromCharCode(a>>6|192):(g+=String.fromCharCode(a>>12|224),g+=String.fromCharCode(a>>6&63|128)),g+=String.fromCharCode(a&63|128));return g};f=function(d){for(var g="",b=0,a=0,c=0,h=0;b<d.length;)a=d.charCodeAt(b),128>a?(g+=String.fromCharCode(a),b+=1):191<a&&224>a?(c=d.charCodeAt(b+1),g+=String.fromCharCode((a&31)<<
6|c&63),b+=2):(c=d.charCodeAt(b+1),h=d.charCodeAt(b+2),g+=String.fromCharCode((a&15)<<12|(c&63)<<6|h&63),b+=3);return g};return{encode:function(f){for(var g="",b,a,c,h,i,k,l=0,f=e(f);l<f.length;)b=f.charCodeAt(l+=1),a=f.charCodeAt(l+=1),c=f.charCodeAt(l+=1),h=b>>2,b=(b&3)<<4|a>>4,i=(a&15)<<2|c>>6,k=c&63,isNaN(a)?i=k=64:isNaN(c)&&(k=64),g=g+d.Utils.keyStr.charAt(h)+Base64.keyStr.charAt(b)+d.Utils.keyStr.charAt(i)+Base64.keyStr.charAt(k);return g},decode:function(e){for(var g="",b,a,c,h,i,k=0,e=e.replace(/[^A-Za-z0-9\+\/\=]/g,
"");k<e.length;)b=d.Utils.keyStr.indexOf(e.charAt(k+=1)),a=d.Utils.keyStr.indexOf(e.charAt(k+=1)),h=d.Utils.keyStr.indexOf(e.charAt(k+=1)),i=d.Utils.keyStr.indexOf(e.charAt(k+=1)),b=b<<2|a>>4,a=(a&15)<<4|h>>2,c=(h&3)<<6|i,g+=String.fromCharCode(b),64!==h&&(g+=String.fromCharCode(a)),64!==i&&(g+=String.fromCharCode(c));return g=f(g)}}}(JSTACK);JSTACK.Keystone=function(d,e){var f,j;j={DISCONNECTED:0,AUTHENTICATING:1,AUTHENTICATED:2,AUTHENTICATION_ERROR:3};f={url:e,currentstate:e,access:e,token:e};return{STATES:j,params:f,init:function(d,b){console.log("Admin URL"+b);f.url=d;f.adminUrl=b;f.access=e;f.token=e;f.currentstate=j.DISCONNECTED},authenticate:function(g,b,a,c,h,i){var k={},k=a!==e?{auth:{token:{id:a}}}:{auth:{passwordCredentials:{username:g,password:b}}};c!==e&&(k.auth.tenantId=c);f.currentstate=j.AUTHENTICATING;d.Comm.post(f.url+
"tokens",k,e,function(a){f.currentstate=d.Keystone.STATES.AUTHENTICATED;f.access=a.access;f.token=f.access.token.id;h!==e&&h(a)},function(a){f.currentstate=j.AUTHENTICATION_ERROR;i(a)})},gettenants:function(g){f.currentstate===d.Keystone.STATES.AUTHENTICATED&&d.Comm.get(f.url+"tenants",f.token,function(d){g!==e&&g(d)},function(d){throw Error(d);})},getservice:function(d){var b,a;if(f.currentstate!==j.AUTHENTICATED)return e;for(b in f.access.serviceCatalog)if(f.access.serviceCatalog[b]!==e&&(a=f.access.serviceCatalog[b],
d===a.type))return a;return e},getservicelist:function(){return f.currentstate!==j.AUTHENTICATED?e:f.access.serviceCatalog},createuser:function(e,b,a,c,h,i,k){f.currentstate===d.Keystone.STATES.AUTHENTICATED&&d.Comm.post(f.adminUrl+"users",{user:{name:name,password:b,tenantId:a,email:c,enabled:h}},f.token,i,k)},getusers:function(g,b,a){if(f.currentstate===d.Keystone.STATES.AUTHENTICATED){var c="",c=g!==e?f.adminUrl+"tenants/"+g+"/users":f.adminUrl+"users";d.Comm.get(c,f.token,b,a)}},getuser:function(e,
b,a){f.currentstate===d.Keystone.STATES.AUTHENTICATED&&d.Comm.get(f.adminUrl+"users"+e,f.token,b,a)},deleteuser:function(e,b,a){f.currentstate===d.Keystone.STATES.AUTHENTICATED&&d.Comm.del(f.adminUrl+"users"+e,f.token,b,a)},getuserroles:function(g,b,a,c){if(f.currentstate===d.Keystone.STATES.AUTHENTICATED){var h="",h=b!==e?f.adminUrl+"tenants/"+b+"/users/"+g+"/roles":f.adminUrl+"users/"+g+"/roles";d.Comm.get(h,f.token,a,c)}},adduserrole:function(g,b,a,c,h){if(f.currentstate===d.Keystone.STATES.AUTHENTICATED){var i=
"",i=a!==e?f.adminUrl+"tenants/"+a+"/users/"+g+"/roles/OS-KSADM/"+b:f.adminUrl+"users/"+g+"/roles/OS-KSADM/"+b;d.Comm.put(i,f.token,c,h)}},removeuserrole:function(g,b,a,c,h){if(f.currentstate===d.Keystone.STATES.AUTHENTICATED){var i="",i=a!==e?f.adminUrl+"tenants/"+a+"/users/"+g+"/roles/OS-KSADM/"+b:f.adminUrl+"users/"+g+"/roles/OS-KSADM/"+b;d.Comm.del(i,f.token,c,h)}},createtenant:function(e,b,a,c,h){f.currentstate===d.Keystone.STATES.AUTHENTICATED&&d.Comm.post(f.adminUrl+"tenants",{tenant:{name:e,
description:b,enabled:a}},f.token,c,h)},deletetenant:function(e,b,a){f.currentstate===d.Keystone.STATES.AUTHENTICATED&&d.Comm.del(f.adminUrl+"tenants"+e,data,f.token,b,a)}}}(JSTACK);JSTACK.Nova=function(d,e){var f,j,g,b;f=e;j="publicURL";g=function(){return d.Keystone!==e&&d.Keystone.params.currentstate===d.Keystone.STATES.AUTHENTICATED?(f=d.Keystone.getservice("compute").endpoints[0][j],!0):!1};b=function(a,c,h,b){g()&&(a=f+"/servers/"+a+"/action",d.Comm.post(a,c,d.Keystone.params.token,function(a){b!==e&&b(a)},function(a){throw Error(a);}))};return{configure:function(a){if("adminURL"===a||"internalURL"===a||"publicURL"===a)j=a},getserverlist:function(a,c,h){var b;g()&&(b=f+
"/servers",a!==e&&a&&(b+="/detail"),c&&(b+="?all_tenants="+c),d.Comm.get(b,d.Keystone.params.token,function(a){h!==e&&h(a)},function(a){throw Error(a);}))},getserverdetail:function(a,c){var h;g()&&(h=f+"/servers/"+a,d.Comm.get(h,d.Keystone.params.token,function(a){c!==e&&c(a)},function(a){throw Error(a);}))},getserverips:function(a,c,h){g()&&(a=f+"/servers/"+a+"/ips",c!==e&&(a+="/"+c),d.Comm.get(a,d.Keystone.params.token,function(a){h!==e&&h(a)},function(a){throw Error(a);}))},updateserver:function(a,
c,h){g()&&(a=f+"/servers/"+a,c!==e&&d.Comm.put(a,{server:{name:c}},d.Keystone.params.token,function(a){h!==e&&h(a)},function(a){throw Error(a);}))},createserver:function(a,c,h,b,k,j,m,n,o,p){var r=[],q;if(g()){a={server:{name:a,imageRef:c,flavorRef:h}};b!==e&&(a.server.key_name=b);k!==e&&(a.server.user_data=d.Utils.encode(k));if(j!==e){for(q in j)j[q]!==e&&(b={name:j[q]},r.push(b));a.server.security_groups=r}m===e&&(m=1);a.server.min_count=m;n===e&&(n=1);a.server.max_count=n;o!==e&&(a.server.availability_zone=
d.Utils.encode(o));d.Comm.post(f+"/servers",a,d.Keystone.params.token,function(a){p!==e&&p(a)},function(a){throw Error(a);})}},deleteserver:function(a,c){var b;g()&&(b=f+"/servers/"+a,d.Comm.del(b,d.Keystone.params.token,function(a){c!==e&&c(a)},function(a){throw Error(a);}))},changepasswordserver:function(a,c,d){c!==e&&b(a,{changePassword:{adminPass:c}},d)},rebootserverhard:function(a,c){b(a,{reboot:{type:"HARD"}},c)},rebootserversoft:function(a,c){b(a,{reboot:{type:"SOFT"}},c)},resizeserver:function(a,
c,d){b(a,{resize:{flavorRef:c}},d)},confirmresizedserver:function(a,c){b(a,{confirmResize:null},c)},revertresizedserver:function(a,c){b(a,{revertResize:null},c)},startserver:function(a,c){b(a,{"os-start":null},c)},stopserver:function(a,c){b(a,{"os-stop":null},c)},pauseserver:function(a,c){b(a,{pause:null},c)},unpauseserver:function(a,c){b(a,{unpause:null},c)},suspendserver:function(a,c){b(a,{suspend:null},c)},resumeserver:function(a,c){b(a,{resume:null},c)},createimage:function(a,c,d,f){c={createImage:{name:c}};
c.createImage.metadata={};d!==e&&(c.createImage.metadata=d);b(a,c,f)},getflavorlist:function(a,c){var b;g()&&(b=f+"/flavors",a!==e&&a&&(b+="/detail"),d.Comm.get(b,d.Keystone.params.token,function(a){c!==e&&c(a)},function(a){throw Error(a);}))},getflavordetail:function(a,c){var b;g()&&(b=f+"/flavors/"+a,d.Comm.get(b,d.Keystone.params.token,function(a){c!==e&&c(a)},function(a){throw Error(a);}))},createflavor:function(a,c,b,i,k,j,m,n,o){var p;g()&&(p=f+"/flavors",a={flavor:{name:a,ram:c,vcpus:b,disk:i,
id:k,swap:0,"OS-FLV-EXT-DATA:ephemeral":0,rxtx_factor:0}},j!==e&&(a.flavor["OS-FLV-EXT-DATA:ephemeral"]=j),m!==e&&(a.flavor.swap=m),n!==e&&(a.flavor.rxtx_factor=n),d.Comm.post(p,a,d.Keystone.params.token,function(a){o!==e&&o(a)},function(a){throw Error(a);}))},deleteflavor:function(a,c){var b;g()&&(b=f+"/flavors/"+a,d.Comm.del(b,d.Keystone.params.token,function(a){c!==e&&c(a)},function(a){throw Error(a);}))},getimagelist:function(a,c){var b;g()&&(b=f+"/images",a!==e&&a&&(b+="/detail"),d.Comm.get(b,
d.Keystone.params.token,function(a){c!==e&&c(a)},function(a){throw Error(a);}))},getimagedetail:function(a,c){var b;g()&&(b=f+"/images/"+a,d.Comm.get(b,d.Keystone.params.token,function(a){c!==e&&c(a)},function(a){throw Error(a);}))},deleteimage:function(a,c){var b;g()&&(b=f+"/images/"+a,d.Comm.del(b,d.Keystone.params.token,function(a){c!==e&&c(a)},function(a){throw Error(a);}))},getkeypairlist:function(a){var c;g()&&(c=f+"/os-keypairs",d.Comm.get(c,d.Keystone.params.token,function(c){a!==e&&a(c)},
function(a){throw Error(a);}))},createkeypair:function(a,c,b){var i;g()&&(i=f+"/os-keypairs",a={keypair:{name:a}},c!==e&&(a.keypair.public_key=c),d.Comm.post(i,a,d.Keystone.params.token,function(a){b!==e&&b(a)},function(a){throw Error(a);}))},deletekeypair:function(a,b){var h;g()&&(h=f+"/os-keypairs/"+a,d.Comm.del(h,d.Keystone.params.token,function(a){b!==e&&b(a)},function(a){throw Error(a);}))},getvncconsole:function(a,c,d){if(g()){if(c===e||!c)c="novnc";b(a,{"os-getVNCConsole":{type:c}},null,d)}},
getconsoleoutput:function(a,c,d){if(g()){if(c===e||!c)c=35;b(a,{"os-getConsoleOutput":{length:c}},null,d)}},getattachedvolumes:function(a,b){var h;g()&&(h=f+"/servers/"+a+"/os-volume_attachments",d.Comm.get(h,d.Keystone.params.token,function(a){b!==e&&b(a)},function(a){throw Error(a);}))},attachvolume:function(a,b,h,i){g()&&(a=f+"/servers/"+a+"/os-volume_attachments",b===e||h===e||d.Comm.post(a,{volumeAttachment:{volumeId:b,device:h}},d.Keystone.params.token,function(a){i!==e&&i(a)},function(a){throw Error(a);
}))},detachvolume:function(a,b,h){g()&&(a=f+"/servers/"+a+"/os-volume_attachments/"+b,b!==e&&d.Comm.del(a,d.Keystone.params.token,function(a){h!==e&&h(a)},function(a){throw Error(a);}))},getattachedvolume:function(a,b,h){g()&&(a=f+"/servers/"+a+"/os-volume_attachments/"+b,b!==e&&d.Comm.get(a,d.Keystone.params.token,function(a){h!==e&&h(a)},function(a){throw Error(a);}))}}}(JSTACK);JSTACK.Nova.Volume=function(d,e){var f,j,g;f=e;j="publicURL";g=function(){return d.Keystone!==e&&d.Keystone.params.currentstate===d.Keystone.STATES.AUTHENTICATED?(f=d.Keystone.getservice("volume").endpoints[0][j],!0):!1};return{configure:function(b){if("adminURL"===b||"internalURL"===b||"publicURL"===b)j=b},getvolumelist:function(b,a){var c;g()&&(c=f+"/volumes",b!==e&&b&&(c+="/detail"),d.Comm.get(c,d.Keystone.params.token,function(b){a!==e&&a(b)},function(a){throw Error(a);}))},createvolume:function(b,
a,c,h){g()&&(b={volume:{size:b}},a!==e&&(b.volume.display_name=a),c!==e&&(b.volume.display_description=c),d.Comm.post(f+"/volumes",b,d.Keystone.params.token,function(a){h!==e&&h(a)},function(a){throw Error(a);}))},deletevolume:function(b,a){var c;g()&&(c=f+"/volumes/"+b,d.Comm.del(c,d.Keystone.params.token,function(b){a!==e&&a(b)},function(a){throw Error(a);}))},getvolume:function(b,a){var c;g()&&(c=f+"/volumes/"+b,d.Comm.get(c,d.Keystone.params.token,function(b){a!==e&&a(b)},function(a){throw Error(a);
}))},getsnapshotlist:function(b,a){var c;g()&&(c=f+"/snapshots",b!==e&&b&&(c+="/detail"),d.Comm.get(c,d.Keystone.params.token,function(b){a!==e&&a(b)},function(a){throw Error(a);}))},createsnapshot:function(b,a,c,h){g()&&(b={snapshot:{volume_id:b,force:!0}},a!==e&&(b.snapshot.display_name=a),c!==e&&(b.snapshot.display_description=c),d.Comm.post(f+"/snapshots",b,d.Keystone.params.token,function(a){h!==e&&h(a)},function(a){throw Error(a);}))},deletesnapshot:function(b,a){var c;g()&&(c=f+"/snapshots/"+
b,d.Comm.del(c,d.Keystone.params.token,function(b){a!==e&&a(b)},function(a){throw Error(a);}))},getsnapshot:function(b,a){var c;g()&&(c=f+"/snapshots/"+b,d.Comm.get(c,d.Keystone.params.token,function(b){a!==e&&a(b)},function(a){throw Error(a);}))}}}(JSTACK);JSTACK.Glance=function(d,e){var f,j,g;f=e;j="publicURL";g=function(){return d.Keystone!==e&&d.Keystone.params.currentstate===d.Keystone.STATES.AUTHENTICATED?(f=d.Keystone.getservice("image").endpoints[0][j],!0):!1};return{configure:function(b){if("adminURL"===b||"internalURL"===b||"publicURL"===b)j=b},getimagelist:function(b,a){var c;g()&&(c=f+"/images",b!==e&&b&&(c+="/detail"),d.Comm.get(c,d.Keystone.params.token,function(b){a!==e&&a(b)},function(a){throw Error(a);}))}}}(JSTACK);
